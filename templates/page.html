<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>London Culture</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
            line-height: 1.75; color: #e5e5e5; max-width: 680px;
            margin: 0 auto; padding: 3rem 1.5rem;
            background: #0a0a0a;
        }

        /* Header */
        header { margin-bottom: 4rem; }
        h1 {
            font-size: 1.25rem; font-weight: 500;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        .subtitle {
            font-size: 0.9375rem; color: #999;
            line-height: 1.6;
        }
        .updated {
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 0.75rem; color: #666;
            margin-top: 1.5rem;
        }

        /* Filters - text based, minimal */
        .filters {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
        }
        .filter-row {
            display: flex; flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .filter-label {
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 0.6875rem;
            color: #666;
            letter-spacing: 0.02em;
            margin-bottom: 0.5rem;
        }
        .chip {
            font-size: 0.8125rem;
            cursor: pointer;
            color: #666;
            padding: 0;
            border: none;
            background: none;
        }
        .chip:hover { color: #e5e5e5; }
        .chip.active {
            color: #e5e5e5;
            text-decoration: underline;
            text-underline-offset: 3px;
        }
        .count {
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 0.75rem;
            color: #444;
            margin-top: 1rem;
        }

        /* Date headers */
        .date-header {
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 0.6875rem;
            font-weight: 400;
            color: #666;
            letter-spacing: 0.02em;
            margin: 3rem 0 1.5rem 0;
            text-transform: uppercase;
        }
        .date-header:first-child { margin-top: 0; }

        /* Events - minimal, spacious */
        .event {
            margin-bottom: 2rem;
        }
        .event-title {
            margin-bottom: 0.25rem;
        }
        .event-title a {
            color: #e5e5e5;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 400;
        }
        .event-title a:hover {
            text-decoration: underline;
            text-decoration-thickness: 1px;
            text-underline-offset: 2px;
        }
        .event-meta {
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 0.75rem;
            color: #666;
            line-height: 1.6;
        }
        .event-meta .venue { font-weight: 400; }
        .event .desc {
            font-size: 0.875rem;
            color: #999;
            margin-top: 0.5rem;
            line-height: 1.6;
        }
        .event.hidden { display: none; }

        /* Minimal inline indicators */
        .event-meta .free::before {
            content: "free · ";
            color: #666;
        }
        .event-meta .type {
            color: #444;
        }

        footer {
            margin-top: 5rem;
            font-family: 'SF Mono', 'Menlo', 'Consolas', monospace;
            font-size: 0.6875rem;
            color: #444;
        }
        footer a {
            color: #444;
            text-decoration: underline;
            text-decoration-color: #333;
            text-underline-offset: 2px;
        }
        footer a:hover {
            color: #666;
        }

        /* Mobile adjustments */
        @media (max-width: 640px) {
            body { padding: 2rem 1rem; }
            header { margin-bottom: 3rem; }
            .date-header { margin: 2rem 0 1rem 0; }
        }
    </style>
</head>
<body>
    <header>
        <h1>London Culture</h1>
        <p class="subtitle">Talks, openings, workshops, and places to meet interesting people.</p>
        <p class="updated">Updated {{ updated_at }}</p>
    </header>

    <div class="filters">
        <div class="filter-label">Type</div>
        <div class="filter-row" id="cat-filters">
            {% for cat in categories %}
            <span class="chip{% if cat == 'All' %} active{% endif %}" data-filter="cat" data-value="{{ cat }}">{{ cat }}</span>
            {% endfor %}
        </div>

        <div class="filter-label">Source</div>
        <div class="filter-row" id="source-filters">
            <span class="chip active" data-filter="source" data-value="All">All</span>
            {% for source in sources %}
            <span class="chip" data-filter="source" data-value="{{ source }}">{{ source }}</span>
            {% endfor %}
        </div>

        <div class="count"><span id="visible-count">{{ events|length }}</span> events</div>
    </div>

    <div id="events">
        {% set ns = namespace(current_date='') %}
        {% for event in events %}
            {% set event_date_str = event.start_date.strftime('%A %-d %B') if event.start_date else 'Date TBC' %}
            {% if event_date_str != ns.current_date %}
                {% set ns.current_date = event_date_str %}
                <div class="date-header" data-date-header>{{ event_date_str }}</div>
            {% endif %}
            <div class="event" data-cat="{{ event._filter_cat }}" data-source="{{ event._source }}">
                <div class="event-title"><a href="{{ event.url }}">{{ event.title }}</a></div>
                <div class="event-meta">
                    {% if event.is_free %}<span class="free">free</span>{% endif %}
                    {% if event.time %}{{ event.time }}{% endif %}
                    {% if event.venue %} · {{ event.venue }}{% endif %}
                    {% if event._filter_cat and event._filter_cat != 'Other' %}<span class="type"> · {{ event._filter_cat|lower }}</span>{% endif %}
                </div>
                {% if event.description %}<div class="desc">{{ event.description }}</div>{% endif %}
            </div>
        {% endfor %}
    </div>

    <footer>
        Scraped weekly from venue sites and Eventbrite. Something wrong? Check the source.
    </footer>

    <script>
    (function() {
        var activeCat = 'All';
        var activeSource = 'All';

        document.querySelectorAll('.chip').forEach(function(chip) {
            chip.addEventListener('click', function() {
                var filterType = this.dataset.filter;
                var value = this.dataset.value;

                // Update active state in this row
                this.parentNode.querySelectorAll('.chip').forEach(function(c) {
                    c.classList.remove('active');
                });
                this.classList.add('active');

                if (filterType === 'cat') activeCat = value;
                if (filterType === 'source') activeSource = value;

                applyFilters();
            });
        });

        function applyFilters() {
            var count = 0;
            var visibleDates = new Set();

            document.querySelectorAll('.event').forEach(function(el) {
                var catMatch = (activeCat === 'All' || el.dataset.cat === activeCat);
                var sourceMatch = (activeSource === 'All' || el.dataset.source === activeSource);
                var show = catMatch && sourceMatch;

                el.classList.toggle('hidden', !show);
                if (show) {
                    count++;
                    // Find the preceding date header
                    var prev = el.previousElementSibling;
                    while (prev && !prev.hasAttribute('data-date-header')) {
                        prev = prev.previousElementSibling;
                    }
                    if (prev) visibleDates.add(prev);
                }
            });

            // Show/hide date headers
            document.querySelectorAll('[data-date-header]').forEach(function(h) {
                h.classList.toggle('hidden', !visibleDates.has(h));
            });

            document.getElementById('visible-count').textContent = count;
        }
    })();
    </script>
</body>
</html>
